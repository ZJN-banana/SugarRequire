!function(t){"use strict";function n(){this._eves={}}function e(t){var e=this,r=e._e=new n;e.state=i,e.args=t;var a=e._next=[];r.last(o,function(){var t=function(){r.emit(s),delete e.data,e._par&&e._par._e.emit(u),t=null};if(a.length){h(a,function(t){v(function(){t._init()})});var n=0;r.on(u,function(){n++,a.length==n&&(t(),r.off(u))})}else t()})}function r(n,e,r){n=p(n),this._pub=e||{};var i=U.toProm(n,this);this._p=r?r.prom.apply(r,i):_.apply(t,i),this._args=n}var i="wait",a="pending",o="fulfilled",f="rejected",u="wood",s="fire",c=function(){},p=function(t){return Array.prototype.slice.call(t,0)},l=function(t){return Object.prototype.toString.call(t).toLowerCase().replace(/(\[object )|(])/g,"")},h=function(){return[].forEach?function(t,n){return t.forEach(n)}:function(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e)}}(),d=function(t,n){for(var e in n)t[e]=n[e];return t},v=function(){var t=!1,n=[];return function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<n.length;e++)n[e]();n=[],t=!1},0)),n.push(e)}}(),m=function(t){var n=t.match(/(.+\/).+/);return n&&n[1]},g=function(t){var n=t.split(/\//g),e=[];return h(n,function(t){return".."==t&&e.length&&".."!=e.slice(-1)[0]?void e.pop():void e.push(t)}),e.join("/")};n.fn=n.prototype,n.fn._get=function(t){return this._eves[t]||(this._eves[t]={e:[],o:[]})},n.fn.on=function(t,n){this._get(t).e.push(n)},n.fn.one=function(t,n){this._get(t).o.push(n)},n.fn.first=function(t,n){this._get(t).f=n},n.fn.last=function(t,n){this._get(t).l=n},n.fn.off=function(t){delete this._eves[t]},n.fn.emit=function(t,n){var e=this._get(t),r=e.f;r&&r({name:t,type:"first"},n),delete e.f;for(var i=e.o;i.length;)i.shift()({name:t,type:"one"},n);h(e.e,function(e){e({name:t,type:"on"},n)});var a=e.l;a&&a({name:t,type:"last"},n),delete e.l},e.fn=e.prototype,e.fn._init=function(){var t=this,n=t._e,e=t.args;t.state=a;var r,i=e.length,u=[];if(!i)return t.state=o,void n.emit(o,{datas:u,state:o});var s=function(e,c,p){n.emit(a,{data:e,state:c,no:p}),i--,i||(r?n.emit(f,r):(t.state=o,n.emit(o,{datas:u,state:o})),s=r=u=null,n.off(a),n.off(f),n.off(o))};h(e,function(n,e){n.call(t,function(t){u[e]=t,s(t,o,e)},function(n){t.state=f,r=r||[],r.push({no:e,data:n}),s(n,f,e)})})},e.fn.then=function(t){var n=this;return n._e.one(o,function(e,r){t.apply(n,r.datas)}),n},e.fn.catch=function(t){return this._e.one(f,function(n,e){t(e)}),this},e.fn.pend=function(t){return this._e.on(a,function(n,e){t(e)}),this},e.fn.prom=function(){var t=p(arguments),n=new e(t);return n._par=this,this._next.push(n),n},e.fn.send=function(t){return this.data=t,this},e.fn.gift=function(t){h(this._next,function(n){n.send(t)})},e.fn.fire=function(t){return this._e.one(s,t),this};var _=function(){var t=p(arguments),n=new e(t);return v(function(){n._init()}),n};r.fn=r.prototype,r.fn.require=function(){var t=new r(arguments,this._pub,this._p);return t},r.fn.pend=function(t){var n=this;return n._p.pend(function(e){var r;r=e.state!=o?d({val:n._args[e.no],no:e.no},e.data):d({val:n._args[e.no]},e),r.state==P&&A.error(d({args:n._args},r)),t.call(n,r)}),n},r.fn.fail=function(t){var n=this;return n._p.catch(function(n){var e=[];h(n,function(t){e.push(d({no:t.no},t.data))}),t(e)}),n},r.fn.done=function(t){var n=this;return n._p.then(function(){t.apply(n,arguments)}),n},r.fn.post=function(t){return this._p.send(t),this},r.fn.hand=function(t){return this._p.gift(t),this};var y=function(){var t=new r(arguments);return t},b="define",w="defer",j="loading",M="loaded",x="finish",P="error",k=document.head,D={},E={},q={paths:D,baseUrl:"",dataMap:E,tempM:{}},U={toProm:function(t,n){var e=[];return h(t,function(t){var r=U.getPath(t,n);e.push(U.agent(r,n))}),e},getPath:function(t,n){if(D[t]&&(t=D[t]),!/^.+?\/\//.test(t)){/\?.+$/.test(t)||/.js$/.test(t)||(t+=".js");var e=t.match(/^\.\/(.+)/);t=e?m(n._pub.rel)+e[1]:q.baseUrl+t,t=g(t)}return t},agent:function(t){return function(n,e){var r=E[t];if(!r){var i=[];r=E[t]={state:j,proms:i},r.script=U.loadScript(t,function(){var n=q.tempM,e=n.type||"file";switch(r.type=e,r.state=M,e){case b:U.setDefine(t,function(t){r.state=x,h(i,function(n){n.res(t)}),delete r.proms});break;case w:r.state=x;{r.m=n.val}h(i,function(n){U.runDefer(t,n.d,n.res,n.rej)}),delete r.proms;break;default:r.state=x,h(i,function(t){t.res()}),delete r.proms}var a=n.ids;a&&("string"==l(a)?E[a]=r:"array"==l(a)&&h(a,function(t){E[t]=r})),q.tempM={}},function(){r.state=P,h(i,function(n){n.rej({state:P,url:t})}),q.tempM={}})}switch(r.state){case x:switch(r.type){case b:n(r.m);break;case w:U.runDefer(t,this.data,n,e);break;default:n()}break;case j:case M:r.proms.push({res:n,rej:e,d:this.data})}}},loadScript:function(t,n,e){var r=document.createElement("script");return r.type="text/javascript",r.setAttribute("async",!0),r.onload=n,r.onerror=e,r.src=t,v(function(){k.appendChild(r)}),r},setDefine:function(t,n){var e,i=E[t],a=q.tempM,o=a.val;if("function"==l(o)){var f={},u={};e=y(),e._pub.rel=t;var s=!1;u.exports=o.call({FILE:t},function(){var n,i=arguments;return n=s?new r(i,{rel:t}):e.require.apply(e,i)},f,u)||f,s=!0,e._p.fire(function(){var t=u.exports;i.m=t,n(t)})}else i.m=o,n(o);return e},runDefer:function(t,n,e,i){var a=E[t],o=a.m;o.call({FILE:t,data:n},function(){return new r(arguments,{rel:t})},e,function(n){i({state:f,data:n,url:t})})},define:function(t,n){q.tempM={type:b,val:t,ids:n}},defer:function(t,n){q.tempM={type:w,val:t,ids:n}}},L=function(t,n){U.define.call(U,t,n)},S=function(t,n){U.defer.call(U,t,n)},A={config:function(t){q.baseUrl=t.baseUrl||"",d(D,t.paths)},define:L,defer:S,use:function(t){var n=U.getPath(t),e=E[n]||{},r=e.type;return r==b?e.m:r},remove:function(t){var n=U.getPath(t),e=E[n];return e?(delete E[n],!0):void 0},extend:function(t){t(q,U,r)},error:c,version:"3"},C=t.sr;if(C){var F=C.config;F&&A.config(F);var I=C.ready;I&&v(I)}t.require||(t.require=y),t.define||(t.define=L),t.defer||(t.defer=S),t.sr=A}(window);