!function(t){"use strict";function n(){this._eves={}}function e(t){var e=this,r=e._e=new n;e.state=i,e.args=t;var a=e._next=[];r.last(o,function(){var t=function(){r.emit(s),delete e.data,e._par&&e._par._e.emit(f),t=null};if(a.length){h(a,function(t){v(function(){t._init()})});var n=0;r.on(f,function(){n++,a.length==n&&(t(),r.off(f))})}else t()})}function r(){this.init.apply(this,arguments)}var i="wait",a="pending",o="fulfilled",u="rejected",f="wood",s="fire",c=function(){},p=function(t){return Array.prototype.slice.call(t,0)},l=function(t){return Object.prototype.toString.call(t).toLowerCase().replace(/(\[object )|(])/g,"")},h=function(){return[].forEach?function(t,n){return t.forEach(n)}:function(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e)}}(),d=function(t,n){for(var e in n)t[e]=n[e];return t},v=function(){var t=!1,n=[];return function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<n.length;e++)n[e]();n=[],t=!1},0)),n.push(e)}}(),m=function(t){var n=t.match(/(.+\/).+/);return n&&n[1]},g=function(t){var n=t.split(/\//g),e=[];return h(n,function(t){return".."==t&&e.length&&".."!=e.slice(-1)[0]?void e.pop():void e.push(t)}),e.join("/")};n.fn=n.prototype,n.prototype={_get:function(t){return this._eves[t]||(this._eves[t]={e:[],o:[]})},on:function(t,n){this._get(t).e.push(n)},one:function(t,n){this._get(t).o.push(n)},first:function(t,n){this._get(t).f=n},last:function(t,n){this._get(t).l=n},off:function(t){delete this._eves[t]},emit:function(t,n){var e=this._get(t),r=e.f;r&&r({name:t,type:"first"},n),delete e.f;for(var i=e.o;i.length;)i.shift()({name:t,type:"one"},n);h(e.e,function(e){e({name:t,type:"on"},n)});var a=e.l;a&&a({name:t,type:"last"},n),delete e.l}},e.prototype={_init:function(){var t=this,n=t._e,e=t.args;t.state=a;var r,i=e.length,f=[];if(!i)return t.state=o,void n.emit(o,{datas:f,state:o});var s=function(e,c,p){n.emit(a,{data:e,state:c,no:p}),i--,i||(r?n.emit(u,r):(t.state=o,n.emit(o,{datas:f,state:o})),s=r=f=null,n.off(a),n.off(u),n.off(o))};h(e,function(n,e){n.call(t,function(t){f[e]=t,s(t,o,e)},function(n){t.state=u,r=r||[],r.push({no:e,data:n}),s(n,u,e)})})},then:function(t){var n=this;return n._e.one(o,function(e,r){t.apply(n,r.datas)}),n},"catch":function(t){return this._e.one(u,function(n,e){t(e)}),this},pend:function(t){return this._e.on(a,function(n,e){t(e)}),this},prom:function(){var t=p(arguments),n=new e(t);return n._par=this,this._next.push(n),n},send:function(t){return this.data=t,this},gift:function(t){h(this._next,function(n){n.send(t)})},fire:function(t){return this._e.one(s,t),this}};var _=function(){var t=p(arguments),n=new e(t);return v(function(){n._init()}),n};r.fn=r.prototype,r.fn.init=function(n,e,r){this._pub=e||{};var i=U.toProm(n,this);this._p=r?r.prom.apply(r,i):_.apply(t,i),this._args=n},r.fn.require=function(){var t=new r(p(arguments),this._pub,this._p);return t},r.fn.pend=function(t){var n=this;return n._p.pend(function(e){var r;r=e.state!=o?d({val:n._args[e.no],no:e.no},e.data):d({val:n._args[e.no]},e),r.state==k&&A.error(d({args:n._args},r)),t.call(n,r)}),n},r.fn.fail=function(t){var n=this;return n._p["catch"](function(n){var e=[];h(n,function(t){e.push(d({no:t.no},t.data))}),t(e)}),n},r.fn.done=function(t){var n=this;return n._p.then(function(){t.apply(n,arguments)}),n},r.fn.post=function(t){return this._p.send(t),this},r.fn.hand=function(t){return this._p.gift(t),this};var y=function(){var t=new r(p(arguments));return t},b="define",w="defer",j="loading",M="loaded",x="finish",k="error",P=document.head,q={},D={},E={paths:q,baseUrl:"",dataMap:D,tempM:{}},U={toProm:function(t,n){var e=[];return h(t,function(t){var r=U.getPath(t,n);e.push(U.agent(r,n))}),e},getPath:function(t,n){if(q[t]&&(t=q[t]),!/^.+?\/\//.test(t)){/\?.+$/.test(t)||/.js$/.test(t)||(t+=".js");var e=t.match(/^\.\/(.+)/);t=e?m(n._pub.rel)+e[1]:E.baseUrl+t,t=g(t)}return t},agent:function(t){return function(n,e){var r=D[t];if(!r){var i=[];r=D[t]={state:j,proms:i},r.script=U.loadScript(t,function(){var n=E.tempM,e=n.type||"file";switch(r.type=e,r.state=M,e){case b:U.setDefine(t,function(t){r.state=x,h(i,function(n){n.res(t)}),delete r.proms});break;case w:r.state=x;{r.m=n.val}h(i,function(n){U.runDefer(t,n.d,n.res,n.rej)}),delete r.proms;break;default:r.state=x,h(i,function(t){t.res()}),delete r.proms}var a=n.ids;a&&("string"==l(a)?D[a]=r:"array"==l(a)&&h(a,function(t){D[t]=r})),E.tempM={}},function(){r.state=k,h(i,function(n){n.rej({type:k,state:k,url:t})}),E.tempM={}})}switch(r.state){case x:switch(r.type){case b:n(r.m);break;case w:U.runDefer(t,this.data,n,e);break;default:n()}break;case j:case M:r.proms.push({res:n,rej:e,d:this.data});break;case k:e()}}},loadScript:function(t,n,e){var r=document.createElement("script");return r.type="text/javascript",r.setAttribute("async",!0),r.onload=n,r.onerror=e,r.src=t,v(function(){P.appendChild(r)}),r},setDefine:function(t,n){var e,i=D[t],a=E.tempM,o=a.val;if("function"==l(o)){var u={},f={};e=y(),e._pub.rel=t;var s=!1;f.exports=o.call({FILE:t},function(){var n,i=p(arguments);return n=s?new r(i,{rel:t}):e.require.apply(e,i)},u,f)||u,s=!0,e._p.fire(function(){var t=f.exports;i.m=t,n(t)})}else i.m=o,n(o);return e},runDefer:function(t,n,e,i){var a=D[t],o=a.m;o.call({FILE:t,data:n},function(){return new r(p(arguments),{rel:t})},e,function(n){i({state:u,data:n,url:t})})},define:function(t,n){E.tempM={type:b,val:t,ids:n}},defer:function(t,n){E.tempM={type:w,val:t,ids:n}}},L=function(t,n){U.define.call(U,t,n)},S=function(t,n){U.defer.call(U,t,n)},A={config:function(t){E.baseUrl=t.baseUrl||"",d(q,t.paths)},require:y,define:L,defer:S,use:function(t){var n=U.getPath(t),e=D[n]||{},r=e.type;return r==b?e.m:r},remove:function(t){var n=U.getPath(t),e=D[n];return e?(delete D[n],!0):void 0},extend:function(t){t(E,U,r)},error:c,version:"3"},C=t.sr;if(C){var F=C.config;F&&A.config(F);var I=C.ready;I&&v(I)}t.require||(t.require=y),t.define||(t.define=L),t.defer||(t.defer=S),t.sr=A}(window);