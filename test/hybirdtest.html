<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>hybird test</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <link href="brtest.css" type="text/css" rel="stylesheet" />
    <script src="../src/sr.js"></script>
    <script src="../plugin/sr-debug.js"></script>
</head>

<body>

</body>
<script src="brtest.js"></script>
<script>
    var rName = 'requireOrderTest';
    brtest.orderTest(rName, function(con) {
        con.count('doingtest', 3);
        con.one('defineAndDefer');
        con.one('fileDefineDefer');
        con.one('defer2');
        con.one('subdefer');
    });
    brtest.test('file and define and defer test', function(con) {
        require('files/define1', 'files/define2', 'files/defer2')
            .doing(function(e) {
                brtest.order(rName, 'doingtest');
                //console.log(e);
            })
            .done(function(define1data, define2data, defer2data) {
                con.equal('define1data', define1data.val, "define1");
                con.equal('define2data', define2data.val, "IamDefine2");
                con.equal('defer2data', defer2data, "IamResolveData2");
                brtest.order(rName, 'defineAndDefer');
            })
            .require('files/relateDefine2', 'files/defer4', 'files/setData1')
            .post('hahah data')
            .done(function(relateDefine2data, defer4data) {
                con.equal('relateDefine2data', relateDefine2data, {
                    "val": "relateDefineData222",
                    "data1": {
                        "val": "relateDefineData",
                        "d1Data": {
                            "val": "define1"
                        }
                    },
                    "data2": {
                        "val": "IamDefine2"
                    }
                });
                con.equal('defer4data', defer4data, 'Iamdefer4 hahah data');
                con.equal('defer4data', wdata1, 'IamData1');
                brtest.order(rName, 'fileDefineDefer');
            })
            .require('files/defer1', 'files/defer3', 'files/define3')
            .done(function(defer1data, defer3data, define3data) {
                con.equal('defer1data', defer1data, "IamResolveData");
                con.equal('defer3data', defer3data, "IamResolveData3-0");
                con.equal('define3data', define3data.val, "IamModule3");
                brtest.order(rName, 'defer2');
            })
            .require('files/subfile/subdefer1')
            .done(function(subdefer1data) {
                con.equal("subdefer1data", subdefer1data, {
                    "subdefine1data": {
                        "d3": {
                            "val": "IamModule3"
                        }
                    }
                });
                brtest.order(rName, 'subdefer');
            });
    });
    brtest.test('topo test', function(con) {
        var r1 = require('files/subfile/subdefine1').done(function(subdefine1Data) {
            con.equal('subdefine1', subdefine1Data, {
                "d3": {
                    "val": "IamModule3"
                }
            });
        });
        var r2 = r1.require('files/define1', 'files/defer2').done(function(define1Data, defer2Data) {
            con.equal('define1Data', define1Data.val, 'define1');
            con.equal('defer2data', defer2Data, 'IamResolveData2');
        });
        var r3 = r1.require('files/define2', 'files/defer4')
            .post('kkkk')
            .done(function(define2data, defer4data) {
                con.equal('define2data', define2data.val, "IamDefine2");
                con.equal('defer4data', defer4data, 'Iamdefer4 kkkk');
            });

        var r4 = r3.require('files/relateDefine2').done(function(relateDefine2data) {
            con.equal('relateDefine2data', relateDefine2data, {
                "val": "relateDefineData222",
                "data1": {
                    "val": "relateDefineData",
                    "d1Data": {
                        "val": "define1"
                    }
                },
                "data2": {
                    "val": "IamDefine2"
                }
            });
        });
    });
</script>

</html>