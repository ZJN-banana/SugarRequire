<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>defer test</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <link href="brtest.css" type="text/css" rel="stylesheet" />
    <script src="../src/sr.js"></script>
    <script src="../plugin/sr-loster.js"></script>
    <script src="../plugin/sr-debug.js"></script>
</head>

<body>

</body>
<script src="brtest.js"></script>
<script>
    brtest.test('defer test', function(con) {
        var scrEvent1 = R.scriptAgent('files/defer1.js');
        scrEvent1.one('done', function(e) {
            con.equal('defer1 test', e.data, "IamResolveData");
        });

        var scrEvent2 = R.scriptAgent('files/defer2.js');
        scrEvent2.one('done', function(e) {
            con.equal('defer2 test', e.data, "IamResolveData2");
        });

        var scrEvent3 = R.scriptAgent('files/defer3.js');
        scrEvent3.one('done', function(e) {
            con.equal('defer3 test', e.data, "IamResolveData3-0");
        });

        var scrEvent4 = R.scriptAgent('files/defer3.js');
        scrEvent4.one('done', function(e) {
            con.equal('defer3 test2', e.data, "IamResolveData3-1");
            setTimeout(function() {
                var scrEvent5 = R.scriptAgent('files/defer3.js');
                scrEvent5.one('done', function(e2) {
                    con.equal('defer3 test3', e2.data, "IamResolveData3-2");
                });
            }, 100);
        });
    });

    brtest.test('require defer', function(con) {
        require('files/defer1').done(function(deferData) {
            con.equal('defer1 data', deferData, 'IamResolveData');
            //console.log(deferData);
        });

        require('files/defer2', 'files/defer1')
            .done(function(deferdata2, deferdata1) {
                con.equal('defer2 data', deferdata2, 'IamResolveData2');
                con.equal('defer1 data 2', deferdata1, 'IamResolveData');
                //console.log(deferdata2);
            })
            .require('files/defer3')
            .done(function(deferdata3) {
                con.equal('defer3 data', deferdata3, "IamResolveData3-3");
            });
    });

    brtest.test('require defer data test', function(con) {
        var r1 = require('files/defer4').done(function(d4Data) {
            con.equal('defer4 data1', d4Data, 'Iamdefer4 ------custom data 4');
        });
        r1.data = "------custom data 4";

        require('files/defer4')
            .done(function(d4Data) {
                con.equal('defer4 data2', d4Data, 'Iamdefer4 custom data haha');
            })
            .post('custom data haha')
            .require('files/defer4')
            .done(function(d4Data2) {
                con.equal('defer4 data3', d4Data2, 'Iamdefer4 custom data haha22222');
            })
            .post('custom data haha22222');
    });

    brtest.test('hand test', function(con) {
        require('files/defer1')
            .done(function(defer1data) {
                this.hand(defer1data);
                con.equal('defer1data', defer1data, 'IamResolveData');
            })
            .require('files/defer4')
            .done(function(defer4data) {
                con.equal('handdata', defer4data, 'Iamdefer4 IamResolveData');
            });
    });
</script>

</html>